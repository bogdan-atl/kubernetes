Компоненты сети в Kubernetes

Kubernetes имеет несколько ключевых компонентов сети:

Поды (Pods) - это наименьшая и самая простая единица в модели развертывания Kubernetes. Поды представляют собой группу одного или нескольких контейнеров, которые развертываются на одном узле и имеют общую сетевую конфигурацию.

Сервисы (Services) - это абстракция, которая определяет логический набор подов и способ доступа к ним. Сервисы позволяют вам создавать стабильные IP-адреса и DNS-имена, которые перенаправляют трафик к подам, независимо от того, на каком узле они развернуты.

Общение между подами

По умолчанию все поды Kubernetes могут общаться друг с другом без ограничений. Каждый под получает свой собственный IP-адрес, который может использоваться для обмена данными между подами.

Пример

Допустим, у нас есть два пода, развернутых с разными приложениями:

Под frontend с меткой app=frontend и контейнером, слушающим на порту 80.
Под backend с меткой app=backend и контейнером, слушающим на порту 8080.
Чтобы настроить сетевое взаимодействие между этими подами, мы можем создать сервис, который направляет трафик на поды backend:
<pre><code>
apiVersion: v1
kind: Service
metadata:
  name: backend-service
spec:
  selector:
    app: backend
  ports:
    - protocol: TCP
      port: 80
      targetPort: 8080</code></pre>

Этот сервис будет направлять трафик на порт 80 к подам с меткой app=backend, причем трафик будет перенаправлен на порт 8080 контейнера. Чтобы применить этот манифест, сохраните его в файле backend-service.yaml и выполните:

kubectl apply -f backend-service.yaml

Теперь поды frontend могут отправлять запросы к сервису backend-service по имени backend-service.default.svc.cluster.local (или просто backend-service, если они находятся в том же пространстве имен). Сервис будетперенаправлять трафик на поды backend, обеспечивая взаимодействие между подами.

Сетевые политики

В некоторых случаях вам может потребоваться контролировать сетевой доступ между подами. Для этого можно использовать сетевые политики (Network Policies). Сетевые политики определяют, какие поды могут общаться друг с другом, а также какие поды могут отправлять и получать трафик.

Давайте рассмотрим пример сетевой политики, которая разрешает только подам frontend обращаться к подам backend:
<pre><code>

apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: allow-frontend-to-backend
spec:
  podSelector:
    matchLabels:
      app: backend
  ingress:
  - from:
    - podSelector:
        matchLabels:
          app: frontend
    ports:
    - protocol: TCP
      port: 8080</code></pre>

Эта сетевая политика позволяет только подам с меткой app=frontend отправлять трафик на поды с меткой app=backend на порт 8080. Чтобы применить эту сетевую политику, сохраните ее в файле allow-frontend-to-backend.yaml и выполните:

kubectl apply -f allow-frontend-to-backend.yaml

Теперь только поды frontend смогут обращаться к подам backend, а другие поды будут заблокированы.

Заключение

В этом уроке мы рассмотрели основы сетевого взаимодействия в Kubernetes, общение между подами и создание сервисов для направления трафика. Мы также изучили сетевые политики для контроля доступа между подами. Это важные аспекты Kubernetes, которые помогут вам в развертывании и управлении приложениями в кластере.
