Сегодняшний урок будет о назначении квот на пространства имен (namespaces) в Kubernetes. Квоты позволяют администраторам контролировать и ограничивать ресурсы, используемые различными пространствами имен.

Создание пространства имен:
Для начала создадим новое пространство имен, чтобы продемонстрировать использование квот. Создайте файл my-namespace.yaml со следующим содержимым:
<pre><code>
apiVersion: v1
kind: Namespace
metadata:
  name: my-namespace</code></pre>

Примените файл с помощью kubectl:

kubectl apply -f my-namespace.yaml

Создание ResourceQuota:
Теперь создадим объект ResourceQuota, который будет назначать квоты на ресурсы для нашего пространства имен. Создайте файл my-resource-quota.yaml со следующим содержимым:
<pre><code>
apiVersion: v1
kind: ResourceQuota
metadata:
  name: my-resource-quota
  namespace: my-namespace
spec:
  hard:
    pods: "10"
    requests.cpu: "1"
    requests.memory: 1Gi
    limits.cpu: "2"
    limits.memory: 2Gi</code></pre>

Здесь мы ограничиваем количество подов, запрашиваемые и лимиты CPU и памяти для нашего пространства имен. Примените файл с помощью kubectl:

kubectl apply -f my-resource-quota.yaml

Проверка квот:
Чтобы проверить назначенные квоты, вы можете использовать следующую команду:

kubectl describe namespace my-namespace

Вы увидите информацию о квотах в разделе "Resource Quotas".

Создание пода, который превышает квоты:
Если мы попытаемся создать под, который превышает установленные квоты, Kubernetes отклонит его. Например, создайте файл my-pod.yaml со следующим содержимым:
<pre><code>
apiVersion: v1
kind: Pod
metadata:
  name: my-pod
  namespace: my-namespace
spec:
  containers:
  - name: my-container
    image: nginx
    resources:
      limits:
        memory: "3Gi"</code></pre>

Попытайтесь применить файл с помощью kubectl:

kubectl apply -f my-pod.yaml

Kubernetes отклонит создание пода, потому что лимит памяти превышает квоту, установленную для пространства имен.

Управление квотами:

Администраторы могут изменять квоты в соответствии с потребностями проекта. Измените файл my-resource-quota.yaml и обновите квоты. Затем примените обновленные квоты, используя kubectl:

kubectl apply -f my-resource-quota.yaml

Обратите внимание, что при обновлении квоты, они будут применяться ко всем существующим и будущим ресурсам в пространстве имен. Если обновленные квоты устанавливают более строгие ограничения, существующие ресурсы, которые уже превышают эти ограничения, не будут затронуты. Однако любые новые ресурсы должны соответствовать новым квотам.

Удаление квот:
Если вы хотите удалить квоту, вы можете использовать следующую команду:

kubectl delete resourcequota my-resource-quota -n my-namespace

После удаления квоты, пространство имен больше не будет ограничено этими квотами.

Использование LimitRange:
В дополнение к использованию ResourceQuota, вы также можете использовать объект LimitRange для установки ограничений по умолчанию на уровне пространства имен. Это может быть полезным, если вы хотите задать минимальные и максимальные ограничения на ресурсы, которые могут быть запрошены или ограничены для всех подов в пространстве имен.
В заключение, использование квот на пространства имен в Kubernetes - это мощный инструмент для контроля распределения ресурсов между различными проектами и командами. Управление квотами помогает администраторам обеспечивать справедливое распределение ресурсов и предотвращать злоупотребление ресурсами одной командой или проектом.
